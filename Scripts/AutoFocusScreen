require("libs.Utils")
require("libs.ScriptConfig")
require("libs.Stuff")
require("libs.HeroInfo")
local config = ScriptConfig.new()
config:SetParameter("Active", "Q", config.TYPE_HOTKEY)
config:SetParameter("doubletapInterval", 280)
config:Load()

local toggleKey   = config.Active
local doubletapInterval= config.doubletapInterval
local activ       = false
local monitor     = client.screenSize.x/1600
local F14         = drawMgr:CreateFont("F14","Tahoma",14*monitor,550*monitor) 
local debugText1  = drawMgr:CreateText(10*monitor,475*monitor,-1,"debug1",F14) debugText1.visible = true
local debugText2  = drawMgr:CreateText(10*monitor,460*monitor,-1,"debug2",F14) debugText2.visible = true
local debugText3  = drawMgr:CreateText(10*monitor,445*monitor,-1,"debug3",F14) debugText3.visible = true
local start = 0
local me    = entityList:GetMyHero()
local snapshotPos = {me.position.x,me.position.y}
local hotkeyText
if string.byte("A") <= toggleKey and toggleKey <= string.byte("Z") then
	hotkeyText = string.char(toggleKey)
else
	hotkeyText = ""..toggleKey
end

--[[asdasd
function Key(msg,code)
	if client.chat or client.console or client.loading then return end
	
		if IsKeyDown(toggleKey) and GetTick() < (start+doubletapInterval) and not activ then
			entityList:GetMyHero():SafeCastItem("item_cyclone",entityList:GetMyHero())
		end
		if IsKeyDown(toggleKey) and not activ then
			start=GetTick()
			activ = true
			statusText.text = "(" .. hotkeyText .. ") Auto Cyclone: Active"
					end	
		
		
		if code==toggleKey and msg==KEY_UP then 
			statusText.text = "(" .. hotkeyText .. ") Auto Cyclone: Off"
			activ=false
			
			
		end
		
end
]]


	

function Tick(tick)

	local myPos = {me.position.x,me.position.y}
	if not SleepCheck(main) then return end 
	Sleep(30,main)
	
	
	local ID    = me.classId
	
	
		if PlayingGame() and me.alive and not (client.paused or me:IsChanneling()) then
			
			
			--client:ExecuteCmd("+dota_camera_center_on_hero")
			--client:ExecuteCmd("-dota_camera_center_on_hero")
			
			local distMoved = {math.abs(math.abs(myPos[1])-math.abs(snapshotPos[1])),math.abs(math.abs(myPos[2])-math.abs(snapshotPos[2]))}
			debugText1.text =""..distMoved[2]
			debugText2.text =""..distMoved[1]
			--end
		snapshotPos = {me.position.x,me.position.y}
		end
	end




function Load()
	if PlayingGame() then
		local me    = entityList:GetMyHero()
		if not me then
			script:Disable()

		else
			reg = true
			script:RegisterEvent(EVENT_TICK,Tick)
			--script:RegisterEvent(EVENT_KEY,Key)
			script:UnregisterEvent(Load)
		end
	end
end

function GameClose()
	collectgarbage("collect")
	if reg then
		script:UnregisterEvent(Tick)
		script:RegisterEvent(EVENT_TICK,Load)
		reg = false
		statusText.visible = false
	end
end

script:RegisterEvent(EVENT_CLOSE,GameClose)
script:RegisterEvent(EVENT_TICK,Load)
